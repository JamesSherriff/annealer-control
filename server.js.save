const dweetClient = require("node-dweetio");
const dweetio = new dweetClient();

const express = require('express')
const app = express()
const path = require('path')
const port = 3000


var Gpio = require('onoff').Gpio;
var forward = new Gpio(23, 'out');
var backward = new Gpio(		, 'out');
var status = "Stopped";

app.get('/', function(req, res) {
  res.sendFile(path.join(__dirname + '/index.html'));
});

app.get('/forward', function(req, res) {
  backward.writeSync(0);
  forward.writeSync(1);
  status = "Running Forwards";
  res.send('Motor running forwards');
});

app.get('/backward', function(req, res) {
  forward.writeSync(0);
  backward.writeSync(1);
  status = "Running Backwards";
  res.send('Motor running backwards');
});

app.get('/stop', function(req, res) {
  forward.writeSync(0);
  backward.writeSync(0);
  status = "Stopped";
  res.send('Motor stopped');
});

app.get('/status', function(req, res) {
  res.send(status);
});

app.listen(port, () => console.log(`Listening on port ${port}!`))

dweetio.listen_for("station-glass-annealer", function(dweet) {
  console.log(dweet);
  if (dweet.content.action == "open") {
    backward.writeSync(0);
    forward.writeSync(1);
  }
  else {
    forward.writeSync(0);
    backward.writeSync(1);
  }
});
